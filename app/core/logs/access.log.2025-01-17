{"timestamp": "2025-01-17T07:42:14.253350", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "be79c02b-7f7f-4bdb-ba6f-7bf6c8b2c154"}
{"timestamp": "2025-01-17T07:42:14.672023", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T07:42:14.702302", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T07:42:14.703183", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T07:42:14.703789", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T07:42:14.704494", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T07:42:14.706106", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "be79c02b-7f7f-4bdb-ba6f-7bf6c8b2c154", "user_id": "24"}
{"timestamp": "2025-01-17T07:59:57.454195", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T07:59:57.469316", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T07:59:57.494095", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T07:59:57.500446", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: SMSService.__init__() missing 1 required positional argument: 'config'", "exception": {"type": "TypeError", "message": "SMSService.__init__() missing 1 required positional argument: 'config'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 291, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py\", line 605, in solve_dependencies\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py\", line 628, in solve_dependencies\n    solved = await call(**solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/core/dependencies.py\", line 70, in get_sms_service\n    return SMSService()\n           ^^^^^^^^^^^^\n", "TypeError: SMSService.__init__() missing 1 required positional argument: 'config'\n"]}}
{"timestamp": "2025-01-17T08:14:57.855357", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T08:14:57.862065", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 563, "message": "Unexpected error during token verification", "exception": {"type": "AttributeError", "message": "module 'jose.jwt' has no attribute 'InvalidIssuerError'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 496, in verify_token\n    payload = jwt.decode(\n              ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 157, in decode\n    _validate_claims(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 481, in _validate_claims\n    _validate_exp(claims, leeway=leeway)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 314, in _validate_exp\n    raise ExpiredSignatureError(\"Signature has expired.\")\n", "jose.exceptions.ExpiredSignatureError: Signature has expired.\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 503, in verify_token\n    except jwt.InvalidIssuerError:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: module 'jose.jwt' has no attribute 'InvalidIssuerError'\n"]}}
{"timestamp": "2025-01-17T08:14:57.880195", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 1005, "message": "Unexpected error during token validation: 401: Could not validate credentials"}
{"timestamp": "2025-01-17T08:14:57.880790", "level": "WARNING", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 95, "message": "Authentication failed: Token validation failed"}
{"timestamp": "2025-01-17T08:15:14.728095", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "a102850c-cf13-4c86-b0a0-297209792c6b"}
{"timestamp": "2025-01-17T08:15:15.074489", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T08:15:15.083719", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T08:15:15.084223", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T08:15:15.084646", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T08:15:15.085256", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T08:15:15.086777", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "a102850c-cf13-4c86-b0a0-297209792c6b", "user_id": "24"}
{"timestamp": "2025-01-17T08:15:56.859338", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T08:15:56.861004", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T08:15:56.872565", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T08:15:56.879180", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: SMSService.__init__() missing 1 required positional argument: 'config'", "exception": {"type": "TypeError", "message": "SMSService.__init__() missing 1 required positional argument: 'config'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 291, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py\", line 605, in solve_dependencies\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py\", line 628, in solve_dependencies\n    solved = await call(**solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/core/dependencies.py\", line 70, in get_sms_service\n    return SMSService()\n           ^^^^^^^^^^^^\n", "TypeError: SMSService.__init__() missing 1 required positional argument: 'config'\n"]}}
{"timestamp": "2025-01-17T08:22:18.586271", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T08:22:18.593549", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T08:22:18.606480", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T08:22:18.614229", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: 'dict' object has no attribute 'API_KEY'", "exception": {"type": "AttributeError", "message": "'dict' object has no attribute 'API_KEY'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 291, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py\", line 605, in solve_dependencies\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py\", line 628, in solve_dependencies\n    solved = await call(**solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/core/dependencies.py\", line 71, in get_sms_service\n    return SMSService(config=config)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/sms_service.py\", line 55, in __init__\n    'Authorization': f'App {self.config.API_KEY}',\n                            ^^^^^^^^^^^^^^^^^^^\n", "AttributeError: 'dict' object has no attribute 'API_KEY'\n"]}}
{"timestamp": "2025-01-17T08:26:36.734223", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T08:26:36.738972", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T08:26:36.751622", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T08:26:36.760032", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: 'dict' object has no attribute 'API_KEY'", "exception": {"type": "AttributeError", "message": "'dict' object has no attribute 'API_KEY'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 291, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py\", line 605, in solve_dependencies\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py\", line 628, in solve_dependencies\n    solved = await call(**solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/core/dependencies.py\", line 71, in get_sms_service\n    return SMSService(config=config)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/sms_service.py\", line 55, in __init__\n    'Authorization': f'App {self.config.API_KEY}',\n                            ^^^^^^^^^^^^^^^^^^^\n", "AttributeError: 'dict' object has no attribute 'API_KEY'\n"]}}
{"timestamp": "2025-01-17T08:31:23.659160", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T08:31:23.671113", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T08:31:23.701159", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:06:36.088934", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:06:36.103357", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 563, "message": "Unexpected error during token verification", "exception": {"type": "AttributeError", "message": "module 'jose.jwt' has no attribute 'InvalidIssuerError'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 496, in verify_token\n    payload = jwt.decode(\n              ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 157, in decode\n    _validate_claims(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 481, in _validate_claims\n    _validate_exp(claims, leeway=leeway)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 314, in _validate_exp\n    raise ExpiredSignatureError(\"Signature has expired.\")\n", "jose.exceptions.ExpiredSignatureError: Signature has expired.\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 503, in verify_token\n    except jwt.InvalidIssuerError:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: module 'jose.jwt' has no attribute 'InvalidIssuerError'\n"]}}
{"timestamp": "2025-01-17T09:06:36.135773", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 1005, "message": "Unexpected error during token validation: 401: Could not validate credentials"}
{"timestamp": "2025-01-17T09:06:36.136694", "level": "WARNING", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 95, "message": "Authentication failed: Token validation failed"}
{"timestamp": "2025-01-17T09:06:55.016175", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "61c1aa9e-12c7-4fd2-89b3-f866d1c3abb4"}
{"timestamp": "2025-01-17T09:06:55.725170", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T09:06:55.739483", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:06:55.740346", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:06:55.741011", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T09:06:55.741868", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:06:55.745379", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "61c1aa9e-12c7-4fd2-89b3-f866d1c3abb4", "user_id": "24"}
{"timestamp": "2025-01-17T09:07:28.144666", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:07:28.146680", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:07:28.183267", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:07:28.355506", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: name 'class_id' is not defined", "exception": {"type": "NameError", "message": "name 'class_id' is not defined", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 49, in get_active_session\n    class_info = attendance_service.get_class_info(class_id)\n                                                   ^^^^^^^^\n", "NameError: name 'class_id' is not defined\n"]}}
{"timestamp": "2025-01-17T09:12:04.203528", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:12:04.211159", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:12:04.257997", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:12:04.495631", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: 'AsyncSession' object has no attribute 'query'", "exception": {"type": "AttributeError", "message": "'AsyncSession' object has no attribute 'query'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 49, in get_active_session\n    session = attendance_service.get_active_session(clean_registration_number)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/attendance_service.py\", line 47, in get_active_session\n    session = self.db.query(SessionModel).filter(\n              ^^^^^^^^^^^^^\n", "AttributeError: 'AsyncSession' object has no attribute 'query'\n"]}}
{"timestamp": "2025-01-17T09:18:47.133420", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:18:47.152929", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:18:47.192098", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:19:22.486254", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "41bde39d-fbbc-41ab-8b67-2b8d0dcee25e"}
{"timestamp": "2025-01-17T09:19:22.969743", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T09:19:22.987808", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:19:22.988784", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:19:22.989846", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T09:19:22.991765", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:19:22.994445", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "41bde39d-fbbc-41ab-8b67-2b8d0dcee25e", "user_id": "24"}
{"timestamp": "2025-01-17T09:19:53.821870", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:19:53.824780", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:19:53.874604", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:24:06.724761", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:24:06.731025", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:24:06.756034", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:24:07.000713", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: name 'logger' is not defined", "exception": {"type": "NameError", "message": "name 'logger' is not defined", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 82, in get_active_session\n    logger.exception(\"Unexpected error in get_active_session\")\n    ^^^^^^\n", "NameError: name 'logger' is not defined\n"]}}
{"timestamp": "2025-01-17T09:25:18.651108", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:25:18.675603", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:25:18.720868", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:25:18.996467", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 50, "message": "Current user data: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x7f37afdd3170>, 'phone': '0728870186', 'id': 24, 'date_of_birth': None, 'created_at': datetime.datetime(2025, 1, 12, 12, 2, 4, 508718, tzinfo=datetime.timezone.utc), 'name': 'Balmbala Sec School Administrator', 'school_id': 23, 'role': <UserRole.SCHOOL_ADMIN: 'school_admin'>, 'updated_at': None, 'password_hash': '$2b$12$.Q2kEYeYzrhH6MCgYx51n.DneSc6iQVL.Byd03/h8eKQB0mxzBaSm', 'is_active': True, 'email': 'abdihujale85@gmail.com', 'school': <School(name=Balmbala Sec School, county=Garissa, class_system=8-4-4)>}"}
{"timestamp": "2025-01-17T09:25:18.997456", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 51, "message": "Requested school registration: SCH-2025-003"}
{"timestamp": "2025-01-17T09:25:19.000123", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 55, "message": "Cleaned registration: SCH-2025-003"}
{"timestamp": "2025-01-17T09:25:19.002777", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 64, "message": "Comparing user school_id: 23 with requested school: SCH-2025-003"}
{"timestamp": "2025-01-17T09:26:27.422618", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:26:27.427236", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:26:27.461750", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:26:27.515941", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 50, "message": "Current user data: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x7f37afe21130>, 'phone': '0728870186', 'id': 24, 'date_of_birth': None, 'created_at': datetime.datetime(2025, 1, 12, 12, 2, 4, 508718, tzinfo=datetime.timezone.utc), 'name': 'Balmbala Sec School Administrator', 'school_id': 23, 'role': <UserRole.SCHOOL_ADMIN: 'school_admin'>, 'updated_at': None, 'password_hash': '$2b$12$.Q2kEYeYzrhH6MCgYx51n.DneSc6iQVL.Byd03/h8eKQB0mxzBaSm', 'is_active': True, 'email': 'abdihujale85@gmail.com', 'school': <School(name=Balmbala Sec School, county=Garissa, class_system=8-4-4)>}"}
{"timestamp": "2025-01-17T09:26:27.517292", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 51, "message": "Requested school registration: 23"}
{"timestamp": "2025-01-17T09:26:27.518141", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 55, "message": "Cleaned registration: 23"}
{"timestamp": "2025-01-17T09:26:27.518913", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 64, "message": "Comparing user school_id: 23 with requested school: 23"}
{"timestamp": "2025-01-17T09:30:09.849130", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:30:09.855556", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:30:09.873337", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:30:09.902343", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 50, "message": "Current user data: {'_sa_instance_state': <sqlalchemy.orm.state.InstanceState object at 0x7f37afe21250>, 'phone': '0728870186', 'id': 24, 'date_of_birth': None, 'created_at': datetime.datetime(2025, 1, 12, 12, 2, 4, 508718, tzinfo=datetime.timezone.utc), 'name': 'Balmbala Sec School Administrator', 'school_id': 23, 'role': <UserRole.SCHOOL_ADMIN: 'school_admin'>, 'updated_at': None, 'password_hash': '$2b$12$.Q2kEYeYzrhH6MCgYx51n.DneSc6iQVL.Byd03/h8eKQB0mxzBaSm', 'is_active': True, 'email': 'abdihujale85@gmail.com', 'school': <School(name=Balmbala Sec School, county=Garissa, class_system=8-4-4)>}"}
{"timestamp": "2025-01-17T09:30:09.902769", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 51, "message": "Requested school registration: SCH-2025-003"}
{"timestamp": "2025-01-17T09:30:09.903119", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 55, "message": "Cleaned registration: SCH-2025-003"}
{"timestamp": "2025-01-17T09:30:09.903425", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 64, "message": "Comparing user school_id: 23 with requested school: SCH-2025-003"}
{"timestamp": "2025-01-17T09:40:09.192995", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:40:09.202258", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:40:09.217945", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:40:09.321544", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 48, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T09:40:09.322059", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 77, "message": "Unexpected error in get_active_session", "exception": {"type": "AttributeError", "message": "'AttendanceService' object has no attribute 'get_school_by_registration'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 51, in get_active_session\n    school = attendance_service.get_school_by_registration(clean_registration_number)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: 'AttendanceService' object has no attribute 'get_school_by_registration'\n"]}}
{"timestamp": "2025-01-17T09:41:55.825258", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:41:55.827831", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:41:55.841201", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:41:55.955363", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 48, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T09:41:55.955856", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 77, "message": "Unexpected error in get_active_session", "exception": {"type": "AttributeError", "message": "'coroutine' object has no attribute 'id'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 59, in get_active_session\n    if current_user.school_id != school.id:\n                                 ^^^^^^^^^\n", "AttributeError: 'coroutine' object has no attribute 'id'\n"]}}
{"timestamp": "2025-01-17T09:45:52.745875", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:45:52.750904", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:45:52.768970", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:45:53.840156", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 48, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T09:45:53.842081", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 78, "message": "Unexpected error in get_active_session", "exception": {"type": "NameError", "message": "name 'logger' is not defined", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/attendance_service.py\", line 64, in get_school_by_registration\n    select(School)\n    ^^^^^^\n", "NameError: name 'select' is not defined. Did you forget to import 'select'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 51, in get_active_session\n    school = await attendance_service.get_school_by_registration(clean_registration_number)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/attendance_service.py\", line 74, in get_school_by_registration\n    logger.error(f\"Error fetching school: {str(e)}\")\n    ^^^^^^\n", "NameError: name 'logger' is not defined\n"]}}
{"timestamp": "2025-01-17T09:49:28.050685", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:49:28.076120", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 563, "message": "Unexpected error during token verification", "exception": {"type": "AttributeError", "message": "module 'jose.jwt' has no attribute 'InvalidIssuerError'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 496, in verify_token\n    payload = jwt.decode(\n              ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 157, in decode\n    _validate_claims(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 481, in _validate_claims\n    _validate_exp(claims, leeway=leeway)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 314, in _validate_exp\n    raise ExpiredSignatureError(\"Signature has expired.\")\n", "jose.exceptions.ExpiredSignatureError: Signature has expired.\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 503, in verify_token\n    except jwt.InvalidIssuerError:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: module 'jose.jwt' has no attribute 'InvalidIssuerError'\n"]}}
{"timestamp": "2025-01-17T09:49:28.098017", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 1005, "message": "Unexpected error during token validation: 401: Could not validate credentials"}
{"timestamp": "2025-01-17T09:49:28.098405", "level": "WARNING", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 95, "message": "Authentication failed: Token validation failed"}
{"timestamp": "2025-01-17T09:49:42.314326", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "4093ea18-8a50-4595-b3a0-03c22afffa30"}
{"timestamp": "2025-01-17T09:49:42.703985", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T09:49:42.716844", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:49:42.717914", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:49:42.718486", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T09:49:42.719255", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T09:49:42.721005", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "4093ea18-8a50-4595-b3a0-03c22afffa30", "user_id": "24"}
{"timestamp": "2025-01-17T09:50:13.941127", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:50:13.942958", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:50:13.958879", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:50:13.986887", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 48, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T09:50:14.014499", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 78, "message": "Unexpected error in get_active_session", "exception": {"type": "ProgrammingError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: time without time zone <= timestamp without time zone\nHINT:  No operator matches the given name and argument types. You might need to add explicit type casts.\n[SQL: SELECT sessions.id, sessions.name, sessions.start_time, sessions.end_time, sessions.start_date, sessions.end_date, sessions.is_active, sessions.description, sessions.school_id \nFROM sessions \nWHERE sessions.school_id = $1::INTEGER AND sessions.start_time <= $2::TIMESTAMP WITHOUT TIME ZONE AND sessions.end_time >= $3::TIMESTAMP WITHOUT TIME ZONE AND sessions.is_active = true]\n[parameters: (23, datetime.datetime(2025, 1, 17, 12, 50, 13, 990300), datetime.datetime(2025, 1, 17, 12, 50, 13, 990300))]\n(Background on this error at: https://sqlalche.me/e/20/f405)", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 514, in _prepare_and_execute\n    prepared_stmt, attributes = await adapt_connection._prepare(\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 760, in _prepare\n    prepared_stmt = await self._connection.prepare(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/connection.py\", line 636, in prepare\n    return await self._prepare(\n           ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/connection.py\", line 654, in _prepare\n    stmt = await self._get_statement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/connection.py\", line 433, in _get_statement\n    statement = await self._protocol.prepare(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"asyncpg/protocol/protocol.pyx\", line 166, in prepare\n", "asyncpg.exceptions.UndefinedFunctionError: operator does not exist: time without time zone <= timestamp without time zone\nHINT:  No operator matches the given name and argument types. You might need to add explicit type casts.\n", "\nThe above exception was the direct cause of the following exception:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 550, in _prepare_and_execute\n    self._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 501, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 784, in _handle_exception\n    raise translated_error from error\n", "sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: time without time zone <= timestamp without time zone\nHINT:  No operator matches the given name and argument types. You might need to add explicit type casts.\n", "\nThe above exception was the direct cause of the following exception:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 66, in get_active_session\n    session = await attendance_service.get_active_session(school.id)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/attendance_service.py\", line 59, in get_active_session\n    result = await self.db.execute(query)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py\", line 461, in execute\n    result = await greenlet_spawn(\n             ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 201, in greenlet_spawn\n    result = context.throw(*sys.exc_info())\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2247, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 305, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 550, in _prepare_and_execute\n    self._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 501, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 784, in _handle_exception\n    raise translated_error from error\n", "sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: time without time zone <= timestamp without time zone\nHINT:  No operator matches the given name and argument types. You might need to add explicit type casts.\n[SQL: SELECT sessions.id, sessions.name, sessions.start_time, sessions.end_time, sessions.start_date, sessions.end_date, sessions.is_active, sessions.description, sessions.school_id \nFROM sessions \nWHERE sessions.school_id = $1::INTEGER AND sessions.start_time <= $2::TIMESTAMP WITHOUT TIME ZONE AND sessions.end_time >= $3::TIMESTAMP WITHOUT TIME ZONE AND sessions.is_active = true]\n[parameters: (23, datetime.datetime(2025, 1, 17, 12, 50, 13, 990300), datetime.datetime(2025, 1, 17, 12, 50, 13, 990300))]\n(Background on this error at: https://sqlalche.me/e/20/f405)\n"]}}
{"timestamp": "2025-01-17T09:55:15.040076", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T09:55:15.050304", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T09:55:15.063384", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T09:55:15.174926", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 48, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T10:24:59.224887", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T10:24:59.256528", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 563, "message": "Unexpected error during token verification", "exception": {"type": "AttributeError", "message": "module 'jose.jwt' has no attribute 'InvalidIssuerError'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 496, in verify_token\n    payload = jwt.decode(\n              ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 157, in decode\n    _validate_claims(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 481, in _validate_claims\n    _validate_exp(claims, leeway=leeway)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 314, in _validate_exp\n    raise ExpiredSignatureError(\"Signature has expired.\")\n", "jose.exceptions.ExpiredSignatureError: Signature has expired.\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 503, in verify_token\n    except jwt.InvalidIssuerError:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: module 'jose.jwt' has no attribute 'InvalidIssuerError'\n"]}}
{"timestamp": "2025-01-17T10:24:59.299875", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 1005, "message": "Unexpected error during token validation: 401: Could not validate credentials"}
{"timestamp": "2025-01-17T10:24:59.301735", "level": "WARNING", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 95, "message": "Authentication failed: Token validation failed"}
{"timestamp": "2025-01-17T10:25:16.478886", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "0cf10255-f599-4967-b2bf-9bdf0be13cf1"}
{"timestamp": "2025-01-17T10:25:17.030627", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T10:25:17.063324", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T10:25:17.064431", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T10:25:17.065000", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T10:25:17.068390", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T10:25:17.078066", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "0cf10255-f599-4967-b2bf-9bdf0be13cf1", "user_id": "24"}
{"timestamp": "2025-01-17T10:30:05.828134", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T10:30:05.838439", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T10:30:05.872871", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T10:30:06.536715", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: Multiple rows were found when one or none was required", "exception": {"type": "MultipleResultsFound", "message": "Multiple rows were found when one or none was required", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/routes/admin.py\", line 972, in create_session\n    if existing_session.scalar_one_or_none():\n       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/result.py\", line 1487, in scalar_one_or_none\n    return self._only_one_row(\n           ^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/result.py\", line 805, in _only_one_row\n    raise exc.MultipleResultsFound(\n", "sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required\n"]}}
{"timestamp": "2025-01-17T10:33:21.207453", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T10:33:21.228291", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T10:33:21.251738", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T10:33:50.573095", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T10:33:50.574232", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T10:33:50.587526", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T10:36:34.870867", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T10:36:34.877849", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T10:36:34.891086", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T10:36:35.018971", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_session", "line": 1015, "message": "Unexpected error in create_session", "exception": {"type": "NameError", "message": "name 'extract' is not defined", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/admin.py\", line 978, in create_session\n    extract('dow', Session.start_date) ==\n    ^^^^^^^\n", "NameError: name 'extract' is not defined\n"]}}
{"timestamp": "2025-01-17T10:37:34.029374", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T10:37:34.033744", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T10:37:34.048316", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T10:42:25.492279", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T10:42:25.494853", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T10:42:25.511132", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T13:35:40.635662", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "b8171b3c-14f2-4e6f-886e-aa435674e851"}
{"timestamp": "2025-01-17T13:35:41.164942", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T13:35:41.223552", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T13:35:41.224231", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T13:35:41.224594", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T13:35:41.225677", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T13:35:41.228272", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "b8171b3c-14f2-4e6f-886e-aa435674e851", "user_id": "24"}
{"timestamp": "2025-01-17T13:43:58.088552", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T13:43:58.143877", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T13:43:58.219401", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T13:45:02.714769", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T13:45:02.716586", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T13:45:02.736629", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T13:45:34.709116", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T13:45:34.710963", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T13:45:34.725705", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T14:01:05.541814", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T14:01:05.554427", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T14:01:05.576670", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T14:08:19.689729", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T14:08:19.692544", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 563, "message": "Unexpected error during token verification", "exception": {"type": "AttributeError", "message": "module 'jose.jwt' has no attribute 'InvalidIssuerError'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 496, in verify_token\n    payload = jwt.decode(\n              ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 157, in decode\n    _validate_claims(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 481, in _validate_claims\n    _validate_exp(claims, leeway=leeway)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 314, in _validate_exp\n    raise ExpiredSignatureError(\"Signature has expired.\")\n", "jose.exceptions.ExpiredSignatureError: Signature has expired.\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 503, in verify_token\n    except jwt.InvalidIssuerError:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: module 'jose.jwt' has no attribute 'InvalidIssuerError'\n"]}}
{"timestamp": "2025-01-17T14:08:19.709370", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 1005, "message": "Unexpected error during token validation: 401: Could not validate credentials"}
{"timestamp": "2025-01-17T14:08:19.709800", "level": "WARNING", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 95, "message": "Authentication failed: Token validation failed"}
{"timestamp": "2025-01-17T14:08:43.046197", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "95e2fcb5-e69f-4f0c-b4dc-fea95184cfed"}
{"timestamp": "2025-01-17T14:08:43.392917", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T14:08:43.404647", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T14:08:43.405154", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T14:08:43.405463", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T14:08:43.405978", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T14:08:43.406811", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "95e2fcb5-e69f-4f0c-b4dc-fea95184cfed", "user_id": "24"}
{"timestamp": "2025-01-17T14:09:12.967189", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T14:09:12.968449", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T14:09:12.983592", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T14:10:04.188642", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T14:10:04.190301", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T14:10:04.204631", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T14:10:04.225713", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 51, "message": "Processing request for school: SCH-2025-003 "}
{"timestamp": "2025-01-17T14:10:04.231787", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 81, "message": "Unexpected error in get_active_session", "exception": {"type": "ResourceNotFoundException", "message": "School with registration number SCH-2025-003  not found", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 54, in get_active_session\n    school = await attendance_service.get_school_by_registration(clean_registration_number)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/attendance_service.py\", line 87, in get_school_by_registration\n    raise ResourceNotFoundException(f\"School with registration number {registration_number} not found\")\n", "app.core.exceptions.ResourceNotFoundException: School with registration number SCH-2025-003  not found\n"]}}
{"timestamp": "2025-01-17T16:47:58.295597", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "3a31dc15-e569-4728-9f8f-ea5c99d921d2"}
{"timestamp": "2025-01-17T16:47:58.659203", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T16:47:58.708951", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T16:47:58.709524", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T16:47:58.709828", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T16:47:58.710319", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T16:47:58.711776", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "3a31dc15-e569-4728-9f8f-ea5c99d921d2", "user_id": "24"}
{"timestamp": "2025-01-17T19:09:31.083525", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "6d2c8c58-5bc2-4bcc-a788-e581dd58e400"}
{"timestamp": "2025-01-17T19:09:34.055379", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T19:09:34.120477", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T19:09:34.121912", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T19:09:34.122322", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T19:09:34.124748", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T19:09:34.146911", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "6d2c8c58-5bc2-4bcc-a788-e581dd58e400", "user_id": "24"}
{"timestamp": "2025-01-17T19:10:12.762331", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:10:12.765766", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:10:12.814399", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:10:12.859299", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T19:11:52.890783", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:11:52.893394", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:11:52.906574", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:13:28.331644", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:13:28.337193", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:13:28.349460", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:13:39.585873", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:13:39.586686", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:13:39.600489", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:14:59.713810", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:14:59.716311", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:14:59.728583", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:15:19.721639", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:15:19.722522", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:15:19.736153", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:15:45.801316", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:15:45.802265", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:15:45.814933", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:16:48.658478", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:16:48.660084", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:16:48.672126", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:16:54.476529", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:16:54.477328", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:16:54.490036", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:16:54.509413", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T19:20:03.695772", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:20:03.700383", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:20:03.712935", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:20:03.822396", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T19:23:08.669595", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:23:08.672303", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:23:08.684515", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:23:08.770440", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T19:23:08.771235", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 84, "message": "Unexpected error in get_active_session", "exception": {"type": "AttributeError", "message": "'AttendanceService' object has no attribute 'get_school_by_registration'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 57, in get_active_session\n    school = await attendance_service.get_school_by_registration(clean_registration_number)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: 'AttendanceService' object has no attribute 'get_school_by_registration'\n"]}}
{"timestamp": "2025-01-17T19:24:19.817854", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:24:19.834920", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:24:19.850312", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:24:19.986266", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T19:24:19.989744", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 46, "message": "Searching for session at: Date=2025-01-17, Time=22:24:19, Day=FRIDAY"}
{"timestamp": "2025-01-17T19:27:43.307804", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:27:43.318179", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:27:43.333066", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:27:43.476704", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T19:27:43.480095", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 46, "message": "Searching for session at: Date=2025-01-17, Time=22:27:43, Day=FRIDAY"}
{"timestamp": "2025-01-17T19:28:32.074843", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:28:32.076842", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:28:32.089731", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:28:32.124982", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: 2 validation errors:\n  {'type': 'list_type', 'loc': ('response', 0, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n  {'type': 'list_type', 'loc': ('response', 2, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n", "exception": {"type": "ResponseValidationError", "message": "2 validation errors:\n  {'type': 'list_type', 'loc': ('response', 0, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n  {'type': 'list_type', 'loc': ('response', 2, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 327, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 176, in serialize_response\n    raise ResponseValidationError(\n", "fastapi.exceptions.ResponseValidationError: 2 validation errors:\n  {'type': 'list_type', 'loc': ('response', 0, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n  {'type': 'list_type', 'loc': ('response', 2, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n\n"]}}
{"timestamp": "2025-01-17T19:28:39.425966", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:28:39.427197", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:28:39.438519", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:28:39.461559", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: 2 validation errors:\n  {'type': 'list_type', 'loc': ('response', 0, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n  {'type': 'list_type', 'loc': ('response', 2, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n", "exception": {"type": "ResponseValidationError", "message": "2 validation errors:\n  {'type': 'list_type', 'loc': ('response', 0, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n  {'type': 'list_type', 'loc': ('response', 2, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 327, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 176, in serialize_response\n    raise ResponseValidationError(\n", "fastapi.exceptions.ResponseValidationError: 2 validation errors:\n  {'type': 'list_type', 'loc': ('response', 0, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n  {'type': 'list_type', 'loc': ('response', 2, 'weekdays'), 'msg': 'Input should be a valid list', 'input': None}\n\n"]}}
{"timestamp": "2025-01-17T19:29:13.194345", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:29:13.197714", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:29:13.211564", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:32:15.897464", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:32:15.899435", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:32:15.909515", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:32:54.567043", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:32:54.568004", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:32:54.580500", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:32:54.599031", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2024-003"}
{"timestamp": "2025-01-17T19:34:07.820868", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:34:07.821910", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:34:07.835620", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:34:07.855860", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T19:34:07.858114", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 46, "message": "Searching for session at: Date=2025-01-17, Time=22:34:07, Day=FRIDAY"}
{"timestamp": "2025-01-17T19:34:07.875803", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 63, "message": "Potential session found:\n  Name: Term1 Night\n  Active: True\n  Date Range: 2025-01-15 to 2025-04-15\n  Time Range: 22:00:00 to 22:40:00\n  Weekdays: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Matches current time? True\n  Matches weekday? True"}
{"timestamp": "2025-01-17T19:36:41.584710", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:36:41.590046", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:36:41.603494", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:36:41.707183", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "get_active_session", "line": 54, "message": "Processing request for school: SCH-2025-003"}
{"timestamp": "2025-01-17T19:36:41.711225", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 46, "message": "Searching for session at: Date=2025-01-17, Time=22:36:41, Day=FRIDAY"}
{"timestamp": "2025-01-17T19:36:41.723435", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 64, "message": "Checking session Term1 Night:\n  Time match: True\n  Day match: True\n  Current time: 22:36:41, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T19:48:36.276695", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:48:36.285282", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 563, "message": "Unexpected error during token verification", "exception": {"type": "AttributeError", "message": "module 'jose.jwt' has no attribute 'InvalidIssuerError'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 496, in verify_token\n    payload = jwt.decode(\n              ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 157, in decode\n    _validate_claims(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 481, in _validate_claims\n    _validate_exp(claims, leeway=leeway)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 314, in _validate_exp\n    raise ExpiredSignatureError(\"Signature has expired.\")\n", "jose.exceptions.ExpiredSignatureError: Signature has expired.\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 503, in verify_token\n    except jwt.InvalidIssuerError:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: module 'jose.jwt' has no attribute 'InvalidIssuerError'\n"]}}
{"timestamp": "2025-01-17T19:48:36.307674", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 1005, "message": "Unexpected error during token validation: 401: Could not validate credentials"}
{"timestamp": "2025-01-17T19:48:36.308104", "level": "WARNING", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 95, "message": "Authentication failed: Token validation failed"}
{"timestamp": "2025-01-17T19:59:08.246422", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "29b14723-f87f-43eb-a9b3-f020b0e539e5"}
{"timestamp": "2025-01-17T19:59:08.757374", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T19:59:08.782788", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T19:59:08.783686", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T19:59:08.784155", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T19:59:08.786010", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T19:59:08.788213", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "29b14723-f87f-43eb-a9b3-f020b0e539e5", "user_id": "24"}
{"timestamp": "2025-01-17T19:59:59.675585", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T19:59:59.683036", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T19:59:59.700597", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T19:59:59.757777", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 46, "message": "Searching for session at: Date=2025-01-17, Time=22:59:59, Day=FRIDAY"}
{"timestamp": "2025-01-17T19:59:59.811172", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 64, "message": "Checking session Term1 Night:\n  Time match: False\n  Day match: True\n  Current time: 22:59:59, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T20:01:11.417967", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:01:11.420486", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:01:11.437079", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:03:31.440706", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:03:31.442643", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:03:31.454910", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:04:08.333066", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:04:08.334128", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:04:08.347719", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:04:22.140541", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:04:22.141720", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:04:22.155226", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:04:35.001105", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:04:35.001910", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:04:35.015336", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:04:47.021987", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:04:47.023565", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:04:47.035552", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:08:13.973713", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:08:13.988844", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:08:14.007277", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:09:13.962045", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:09:13.963941", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:09:13.981247", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:09:31.957532", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:09:31.958645", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:09:31.972764", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:09:31.993697", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 46, "message": "Searching for session at: Date=2025-01-17, Time=23:09:31, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:09:32.002531", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 64, "message": "Checking session Term1 Night:\n  Time match: False\n  Day match: True\n  Current time: 23:09:31, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T20:13:08.520749", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:13:08.529690", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:13:08.549022", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:13:08.729107", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 46, "message": "Searching for session at: Date=2025-01-17, Time=23:13:08, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:13:08.757973", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 64, "message": "Checking session Term1 Night:\n  Time match: False\n  Day match: True\n  Current time: 23:13:08, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T20:16:22.478659", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:16:22.481956", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:16:22.495907", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:16:22.611722", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 56, "message": "Searching for session at: Date=2025-01-17, Time=23:16:22, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:16:22.621610", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 75, "message": "Checking session Term1 Night:\n  Time match: False\n  Day match: True\n  Current time: 23:16:22, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T20:22:19.527612", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:22:19.571473", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:22:19.604955", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:22:19.912119", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 48, "message": "Searching for session at: Date=2025-01-17, Time=23:22:19, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:22:19.924953", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 63, "message": "Found 1 potentially active sessions"}
{"timestamp": "2025-01-17T20:22:19.925344", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 88, "message": "Checking time 23:22:19 against session 22:00:00-22:40:00"}
{"timestamp": "2025-01-17T20:22:19.925786", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 97, "message": "Time check result: False"}
{"timestamp": "2025-01-17T20:22:19.926187", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 70, "message": "Checking session Term1 Night (ID: 5):\n  Time match: False\n  Day match: True\n  Current time: 23:22:19, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-15, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:22:19.926541", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 83, "message": "No matching active session found"}
{"timestamp": "2025-01-17T20:26:12.457616", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:26:12.503920", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:26:12.527870", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:26:12.699485", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 48, "message": "Searching for session at: Date=2025-01-17, Time=23:26:12, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:26:12.733937", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 55, "message": "Total sessions for school: 6"}
{"timestamp": "2025-01-17T20:26:12.734618", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Session:\n  ID: 1\n  Active: True\n  Time: 08:00:00-08:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:26:12.735066", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 2 Session:\n  ID: 2\n  Active: True\n  Time: 09:00:00-09:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:26:12.735482", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Maths:\n  ID: 3\n  Active: True\n  Time: 08:00:00-12:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:26:12.735814", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Night:\n  ID: 4\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:26:12.736215", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term1 Night:\n  ID: 5\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2025-01-15-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:26:12.736575", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 6\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:26:12.743299", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 73, "message": "Sessions after active check: ['Term 1 Session', 'Term 2 Session', 'Maths', 'Term 1 Night', 'Term1 Night', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:26:12.750749", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 82, "message": "Sessions after date check: ['Term1 Night']"}
{"timestamp": "2025-01-17T20:26:12.756586", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 97, "message": "Found 1 potentially active sessions"}
{"timestamp": "2025-01-17T20:26:12.757400", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:26:12 against session 22:00:00-22:40:00"}
{"timestamp": "2025-01-17T20:26:12.757797", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: False"}
{"timestamp": "2025-01-17T20:26:12.758173", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Term1 Night (ID: 5):\n  Time match: False\n  Day match: True\n  Current time: 23:26:12, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-15, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:26:12.758624", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 117, "message": "No matching active session found"}
{"timestamp": "2025-01-17T20:32:31.063116", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:32:31.092751", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 563, "message": "Unexpected error during token verification", "exception": {"type": "AttributeError", "message": "module 'jose.jwt' has no attribute 'InvalidIssuerError'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 496, in verify_token\n    payload = jwt.decode(\n              ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 157, in decode\n    _validate_claims(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 481, in _validate_claims\n    _validate_exp(claims, leeway=leeway)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 314, in _validate_exp\n    raise ExpiredSignatureError(\"Signature has expired.\")\n", "jose.exceptions.ExpiredSignatureError: Signature has expired.\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 503, in verify_token\n    except jwt.InvalidIssuerError:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: module 'jose.jwt' has no attribute 'InvalidIssuerError'\n"]}}
{"timestamp": "2025-01-17T20:32:31.126119", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 1005, "message": "Unexpected error during token validation: 401: Could not validate credentials"}
{"timestamp": "2025-01-17T20:32:31.128233", "level": "WARNING", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 95, "message": "Authentication failed: Token validation failed"}
{"timestamp": "2025-01-17T20:38:00.527861", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "6609b0d1-2a31-438c-a080-84351786351b"}
{"timestamp": "2025-01-17T20:38:00.990970", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 710, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-17T20:38:01.025347", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T20:38:01.025881", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 448, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-17T20:38:01.026172", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 727, "message": "Token expiration times"}
{"timestamp": "2025-01-17T20:38:01.028175", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 767, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-17T20:38:01.032018", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 236, "message": "Login successful", "request_id": "6609b0d1-2a31-438c-a080-84351786351b", "user_id": "24"}
{"timestamp": "2025-01-17T20:38:46.991435", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:38:46.997463", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:38:47.017970", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:39:11.896423", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:39:11.898064", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:39:11.913061", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:39:11.986465", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 48, "message": "Searching for session at: Date=2025-01-17, Time=23:39:11, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:39:12.001492", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 55, "message": "Total sessions for school: 7"}
{"timestamp": "2025-01-17T20:39:12.005650", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Session:\n  ID: 1\n  Active: True\n  Time: 08:00:00-08:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:39:12.007721", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 2 Session:\n  ID: 2\n  Active: True\n  Time: 09:00:00-09:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:39:12.011924", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Maths:\n  ID: 3\n  Active: True\n  Time: 08:00:00-12:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:39:12.016108", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Night:\n  ID: 4\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:39:12.019789", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term1 Night:\n  ID: 5\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2025-01-15-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:39:12.022471", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 6\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:39:12.024566", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 7\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2025-01-17-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:39:12.047078", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 73, "message": "Sessions after active check: ['Term 1 Session', 'Term 2 Session', 'Maths', 'Term 1 Night', 'Term1 Night', 'Late Night Study', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:39:12.065945", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 82, "message": "Sessions after date check: ['Term1 Night', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:39:12.088080", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 97, "message": "Found 2 potentially active sessions"}
{"timestamp": "2025-01-17T20:39:12.089148", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:39:11 against session 22:00:00-22:40:00"}
{"timestamp": "2025-01-17T20:39:12.089907", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: False"}
{"timestamp": "2025-01-17T20:39:12.094245", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Term1 Night (ID: 5):\n  Time match: False\n  Day match: True\n  Current time: 23:39:11, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-15, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:39:12.095488", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:39:11 against session 23:00:00-04:00:00"}
{"timestamp": "2025-01-17T20:39:12.096226", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: True"}
{"timestamp": "2025-01-17T20:39:12.097076", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Late Night Study (ID: 7):\n  Time match: True\n  Day match: True\n  Current time: 23:39:11, Session time: 23:00:00-04:00:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-17, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:39:12.097861", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 114, "message": "Found matching session: Late Night Study"}
{"timestamp": "2025-01-17T20:39:12.103928", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:39:12 against session 23:00:00-04:00:00"}
{"timestamp": "2025-01-17T20:39:12.104368", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: True"}
{"timestamp": "2025-01-17T20:39:12.104943", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "mark_attendance", "line": 202, "message": "Validating session Late Night Study:\n  Time match: True\n  Day match: True\n  Date match: True\n  Current time: 23:39:12, Session time: 23:00:00-04:00:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T20:39:12.173743", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "mark_student_attendance", "line": 142, "message": "Unexpected error in mark_student_attendance", "exception": {"type": "IntegrityError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (1, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, null, null).\n[SQL: INSERT INTO student_attendances (student_id, session_id, date, status, check_in_time, check_out_time, is_approved, remarks, school_id, user_id) VALUES ($1::INTEGER, $2::INTEGER, $3::TIMESTAMP WITH TIME ZONE, $4::VARCHAR, $5::TIMESTAMP WITH TIME ZONE, $6::TIMESTAMP WITH TIME ZONE, $7::BOOLEAN, $8::VARCHAR, $9::INTEGER, $10::INTEGER) RETURNING student_attendances.id]\n[parameters: (2, 7, datetime.date(2025, 1, 17), 'PRESENT', None, None, False, 'Student arrived on time', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 538, in _prepare_and_execute\n    self._rows = deque(await prepared_stmt.fetch(*parameters))\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 241, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 230, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"asyncpg/protocol/protocol.pyx\", line 207, in bind_execute\n", "asyncpg.exceptions.NotNullViolationError: null value in column \"school_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (1, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, null, null).\n", "\nThe above exception was the direct cause of the following exception:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 550, in _prepare_and_execute\n    self._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 501, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 784, in _handle_exception\n    raise translated_error from error\n", "sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (1, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, null, null).\n", "\nThe above exception was the direct cause of the following exception:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 131, in mark_student_attendance\n    attendance = await attendance_service.mark_attendance(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/attendance_service.py\", line 249, in mark_attendance\n    await self.db.commit()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1009, in commit\n    await greenlet_spawn(self.sync_session.commit)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n             ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n", "  File \"<string>\", line 2, in commit\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n", "  File \"<string>\", line 2, in _prepare_impl\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 550, in _prepare_and_execute\n    self._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 501, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 784, in _handle_exception\n    raise translated_error from error\n", "sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (1, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, null, null).\n[SQL: INSERT INTO student_attendances (student_id, session_id, date, status, check_in_time, check_out_time, is_approved, remarks, school_id, user_id) VALUES ($1::INTEGER, $2::INTEGER, $3::TIMESTAMP WITH TIME ZONE, $4::VARCHAR, $5::TIMESTAMP WITH TIME ZONE, $6::TIMESTAMP WITH TIME ZONE, $7::BOOLEAN, $8::VARCHAR, $9::INTEGER, $10::INTEGER) RETURNING student_attendances.id]\n[parameters: (2, 7, datetime.date(2025, 1, 17), 'PRESENT', None, None, False, 'Student arrived on time', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)\n"]}}
{"timestamp": "2025-01-17T20:42:55.068980", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:42:55.111203", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:42:55.137259", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:42:55.301543", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 48, "message": "Searching for session at: Date=2025-01-17, Time=23:42:55, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:42:55.325718", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 55, "message": "Total sessions for school: 7"}
{"timestamp": "2025-01-17T20:42:55.326314", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Session:\n  ID: 1\n  Active: True\n  Time: 08:00:00-08:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:42:55.326724", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 2 Session:\n  ID: 2\n  Active: True\n  Time: 09:00:00-09:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:42:55.327239", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Maths:\n  ID: 3\n  Active: True\n  Time: 08:00:00-12:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:42:55.327737", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Night:\n  ID: 4\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:42:55.328148", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term1 Night:\n  ID: 5\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2025-01-15-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:42:55.328707", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 6\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:42:55.329191", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 7\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2025-01-17-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:42:55.337402", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 73, "message": "Sessions after active check: ['Term 1 Session', 'Term 2 Session', 'Maths', 'Term 1 Night', 'Term1 Night', 'Late Night Study', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:42:55.342932", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 82, "message": "Sessions after date check: ['Term1 Night', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:42:55.352355", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 97, "message": "Found 2 potentially active sessions"}
{"timestamp": "2025-01-17T20:42:55.353046", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:42:55 against session 22:00:00-22:40:00"}
{"timestamp": "2025-01-17T20:42:55.353611", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: False"}
{"timestamp": "2025-01-17T20:42:55.354112", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Term1 Night (ID: 5):\n  Time match: False\n  Day match: True\n  Current time: 23:42:55, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-15, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:42:55.354440", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:42:55 against session 23:00:00-04:00:00"}
{"timestamp": "2025-01-17T20:42:55.354771", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: True"}
{"timestamp": "2025-01-17T20:42:55.355028", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Late Night Study (ID: 7):\n  Time match: True\n  Day match: True\n  Current time: 23:42:55, Session time: 23:00:00-04:00:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-17, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:42:55.355327", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 114, "message": "Found matching session: Late Night Study"}
{"timestamp": "2025-01-17T20:42:55.360482", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:42:55 against session 23:00:00-04:00:00"}
{"timestamp": "2025-01-17T20:42:55.361056", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: True"}
{"timestamp": "2025-01-17T20:42:55.362583", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "mark_attendance", "line": 202, "message": "Validating session Late Night Study:\n  Time match: True\n  Day match: True\n  Date match: True\n  Current time: 23:42:55, Session time: 23:00:00-04:00:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T20:42:55.432534", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "mark_student_attendance", "line": 142, "message": "Unexpected error in mark_student_attendance", "exception": {"type": "IntegrityError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"user_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (2, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, 23, null).\n[SQL: INSERT INTO student_attendances (student_id, session_id, date, status, check_in_time, check_out_time, is_approved, remarks, school_id, user_id) VALUES ($1::INTEGER, $2::INTEGER, $3::TIMESTAMP WITH TIME ZONE, $4::VARCHAR, $5::TIMESTAMP WITH TIME ZONE, $6::TIMESTAMP WITH TIME ZONE, $7::BOOLEAN, $8::VARCHAR, $9::INTEGER, $10::INTEGER) RETURNING student_attendances.id]\n[parameters: (2, 7, datetime.date(2025, 1, 17), 'PRESENT', None, None, False, 'Student arrived on time', 23, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 538, in _prepare_and_execute\n    self._rows = deque(await prepared_stmt.fetch(*parameters))\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 241, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 230, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"asyncpg/protocol/protocol.pyx\", line 207, in bind_execute\n", "asyncpg.exceptions.NotNullViolationError: null value in column \"user_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (2, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, 23, null).\n", "\nThe above exception was the direct cause of the following exception:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 550, in _prepare_and_execute\n    self._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 501, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 784, in _handle_exception\n    raise translated_error from error\n", "sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"user_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (2, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, 23, null).\n", "\nThe above exception was the direct cause of the following exception:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 131, in mark_student_attendance\n    attendance = await attendance_service.mark_attendance(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/attendance_service.py\", line 251, in mark_attendance\n    await self.db.commit()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1009, in commit\n    await greenlet_spawn(self.sync_session.commit)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n             ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n", "  File \"<string>\", line 2, in commit\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n", "  File \"<string>\", line 2, in _prepare_impl\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 550, in _prepare_and_execute\n    self._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 501, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 784, in _handle_exception\n    raise translated_error from error\n", "sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"user_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (2, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, 23, null).\n[SQL: INSERT INTO student_attendances (student_id, session_id, date, status, check_in_time, check_out_time, is_approved, remarks, school_id, user_id) VALUES ($1::INTEGER, $2::INTEGER, $3::TIMESTAMP WITH TIME ZONE, $4::VARCHAR, $5::TIMESTAMP WITH TIME ZONE, $6::TIMESTAMP WITH TIME ZONE, $7::BOOLEAN, $8::VARCHAR, $9::INTEGER, $10::INTEGER) RETURNING student_attendances.id]\n[parameters: (2, 7, datetime.date(2025, 1, 17), 'PRESENT', None, None, False, 'Student arrived on time', 23, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)\n"]}}
{"timestamp": "2025-01-17T20:46:17.347862", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:46:17.409058", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:46:17.464324", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:46:18.616257", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 48, "message": "Searching for session at: Date=2025-01-17, Time=23:46:18, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:46:18.638736", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 55, "message": "Total sessions for school: 7"}
{"timestamp": "2025-01-17T20:46:18.639416", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Session:\n  ID: 1\n  Active: True\n  Time: 08:00:00-08:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:46:18.640002", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 2 Session:\n  ID: 2\n  Active: True\n  Time: 09:00:00-09:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:46:18.640625", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Maths:\n  ID: 3\n  Active: True\n  Time: 08:00:00-12:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:46:18.641294", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Night:\n  ID: 4\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:46:18.641812", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term1 Night:\n  ID: 5\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2025-01-15-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:46:18.642301", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 6\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:46:18.643607", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 7\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2025-01-17-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:46:18.648505", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 73, "message": "Sessions after active check: ['Term 1 Session', 'Term 2 Session', 'Maths', 'Term 1 Night', 'Term1 Night', 'Late Night Study', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:46:18.656235", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 82, "message": "Sessions after date check: ['Term1 Night', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:46:18.661683", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 97, "message": "Found 2 potentially active sessions"}
{"timestamp": "2025-01-17T20:46:18.662312", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:46:18 against session 22:00:00-22:40:00"}
{"timestamp": "2025-01-17T20:46:18.662972", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: False"}
{"timestamp": "2025-01-17T20:46:18.663456", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Term1 Night (ID: 5):\n  Time match: False\n  Day match: True\n  Current time: 23:46:18, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-15, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:46:18.663984", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:46:18 against session 23:00:00-04:00:00"}
{"timestamp": "2025-01-17T20:46:18.665173", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: True"}
{"timestamp": "2025-01-17T20:46:18.666278", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Late Night Study (ID: 7):\n  Time match: True\n  Day match: True\n  Current time: 23:46:18, Session time: 23:00:00-04:00:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-17, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:46:18.667122", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 114, "message": "Found matching session: Late Night Study"}
{"timestamp": "2025-01-17T20:46:18.675512", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:46:18 against session 23:00:00-04:00:00"}
{"timestamp": "2025-01-17T20:46:18.676181", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: True"}
{"timestamp": "2025-01-17T20:46:18.676810", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "mark_attendance", "line": 202, "message": "Validating session Late Night Study:\n  Time match: True\n  Day match: True\n  Date match: True\n  Current time: 23:46:18, Session time: 23:00:00-04:00:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T20:46:18.738526", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "attendance", "function": "mark_student_attendance", "line": 142, "message": "Unexpected error in mark_student_attendance", "exception": {"type": "IntegrityError", "message": "(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"user_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (3, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, 23, null).\n[SQL: INSERT INTO student_attendances (student_id, date, status, check_in_time, check_out_time, is_approved, remarks, session_id, school_id, user_id) VALUES ($1::INTEGER, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::TIMESTAMP WITH TIME ZONE, $5::TIMESTAMP WITH TIME ZONE, $6::BOOLEAN, $7::VARCHAR, $8::INTEGER, $9::INTEGER, $10::INTEGER) RETURNING student_attendances.id]\n[parameters: (2, datetime.date(2025, 1, 17), 'PRESENT', None, None, False, 'Student arrived on time', 7, 23, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 538, in _prepare_and_execute\n    self._rows = deque(await prepared_stmt.fetch(*parameters))\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 241, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py\", line 230, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"asyncpg/protocol/protocol.pyx\", line 207, in bind_execute\n", "asyncpg.exceptions.NotNullViolationError: null value in column \"user_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (3, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, 23, null).\n", "\nThe above exception was the direct cause of the following exception:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 550, in _prepare_and_execute\n    self._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 501, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 784, in _handle_exception\n    raise translated_error from error\n", "sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"user_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (3, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, 23, null).\n", "\nThe above exception was the direct cause of the following exception:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/attendance.py\", line 131, in mark_student_attendance\n    attendance = await attendance_service.mark_attendance(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/attendance_service.py\", line 251, in mark_attendance\n    await self.db.commit()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1009, in commit\n    await greenlet_spawn(self.sync_session.commit)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 203, in greenlet_spawn\n    result = context.switch(value)\n             ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n", "  File \"<string>\", line 2, in commit\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n", "  File \"<string>\", line 2, in _prepare_impl\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 550, in _prepare_and_execute\n    self._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 501, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 784, in _handle_exception\n    raise translated_error from error\n", "sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"user_id\" of relation \"student_attendances\" violates not-null constraint\nDETAIL:  Failing row contains (3, 2, 2025-01-16 13:00:00-08, PRESENT, null, null, f, Student arrived on time, 7, 23, null).\n[SQL: INSERT INTO student_attendances (student_id, date, status, check_in_time, check_out_time, is_approved, remarks, session_id, school_id, user_id) VALUES ($1::INTEGER, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::TIMESTAMP WITH TIME ZONE, $5::TIMESTAMP WITH TIME ZONE, $6::BOOLEAN, $7::VARCHAR, $8::INTEGER, $9::INTEGER, $10::INTEGER) RETURNING student_attendances.id]\n[parameters: (2, datetime.date(2025, 1, 17), 'PRESENT', None, None, False, 'Student arrived on time', 7, 23, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)\n"]}}
{"timestamp": "2025-01-17T20:54:31.313985", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 978, "message": "Attempting to verify token"}
{"timestamp": "2025-01-17T20:54:31.334155", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 641, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 628, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-17T20:54:31.352686", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 998, "message": "Token validated successfully"}
{"timestamp": "2025-01-17T20:54:31.446007", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 48, "message": "Searching for session at: Date=2025-01-17, Time=23:54:31, Day=FRIDAY"}
{"timestamp": "2025-01-17T20:54:31.459260", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 55, "message": "Total sessions for school: 7"}
{"timestamp": "2025-01-17T20:54:31.459642", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Session:\n  ID: 1\n  Active: True\n  Time: 08:00:00-08:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:54:31.459900", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 2 Session:\n  ID: 2\n  Active: True\n  Time: 09:00:00-09:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:54:31.460175", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Maths:\n  ID: 3\n  Active: True\n  Time: 08:00:00-12:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:54:31.460436", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term 1 Night:\n  ID: 4\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:54:31.460718", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Term1 Night:\n  ID: 5\n  Active: True\n  Time: 22:00:00-22:40:00\n  Dates: 2025-01-15-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:54:31.460921", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 6\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2024-01-15-2024-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:54:31.461137", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 57, "message": "Session Late Night Study:\n  ID: 7\n  Active: True\n  Time: 23:00:00-04:00:00\n  Dates: 2025-01-17-2025-04-15\n  School ID: 23"}
{"timestamp": "2025-01-17T20:54:31.463772", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 73, "message": "Sessions after active check: ['Term 1 Session', 'Term 2 Session', 'Maths', 'Term 1 Night', 'Term1 Night', 'Late Night Study', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:54:31.467947", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 82, "message": "Sessions after date check: ['Term1 Night', 'Late Night Study']"}
{"timestamp": "2025-01-17T20:54:31.472335", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 97, "message": "Found 2 potentially active sessions"}
{"timestamp": "2025-01-17T20:54:31.472709", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:54:31 against session 22:00:00-22:40:00"}
{"timestamp": "2025-01-17T20:54:31.472977", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: False"}
{"timestamp": "2025-01-17T20:54:31.473378", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Term1 Night (ID: 5):\n  Time match: False\n  Day match: True\n  Current time: 23:54:31, Session time: 22:00:00-22:40:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-15, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:54:31.473651", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:54:31 against session 23:00:00-04:00:00"}
{"timestamp": "2025-01-17T20:54:31.473911", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: True"}
{"timestamp": "2025-01-17T20:54:31.474145", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 104, "message": "Checking session Late Night Study (ID: 7):\n  Time match: True\n  Day match: True\n  Current time: 23:54:31, Session time: 23:00:00-04:00:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']\n  Start date: 2025-01-17, End date: 2025-04-15"}
{"timestamp": "2025-01-17T20:54:31.474367", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "get_active_session", "line": 114, "message": "Found matching session: Late Night Study"}
{"timestamp": "2025-01-17T20:54:31.477158", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 122, "message": "Checking time 23:54:31 against session 23:00:00-04:00:00"}
{"timestamp": "2025-01-17T20:54:31.477481", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "_is_time_in_session", "line": 131, "message": "Time check result: True"}
{"timestamp": "2025-01-17T20:54:31.477741", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "attendance_service", "function": "mark_attendance", "line": 203, "message": "Validating session Late Night Study:\n  Time match: True\n  Day match: True\n  Date match: True\n  Current time: 23:54:31, Session time: 23:00:00-04:00:00\n  Current day: FRIDAY, Session days: ['MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY']"}
{"timestamp": "2025-01-17T20:54:31.595840", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: 2 validation errors:\n  {'type': 'missing', 'loc': ('response', 'class_id'), 'msg': 'Field required', 'input': <StudentAttendance(student_id=2)>}\n  {'type': 'missing', 'loc': ('response', 'stream_id'), 'msg': 'Field required', 'input': <StudentAttendance(student_id=2)>}\n", "exception": {"type": "ResponseValidationError", "message": "2 validation errors:\n  {'type': 'missing', 'loc': ('response', 'class_id'), 'msg': 'Field required', 'input': <StudentAttendance(student_id=2)>}\n  {'type': 'missing', 'loc': ('response', 'stream_id'), 'msg': 'Field required', 'input': <StudentAttendance(student_id=2)>}\n", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 327, in app\n    content = await serialize_response(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 176, in serialize_response\n    raise ResponseValidationError(\n", "fastapi.exceptions.ResponseValidationError: 2 validation errors:\n  {'type': 'missing', 'loc': ('response', 'class_id'), 'msg': 'Field required', 'input': <StudentAttendance(student_id=2)>}\n  {'type': 'missing', 'loc': ('response', 'stream_id'), 'msg': 'Field required', 'input': <StudentAttendance(student_id=2)>}\n\n"]}}
