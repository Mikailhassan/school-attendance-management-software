{"timestamp": "2025-01-13T16:21:36.656402", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 216, "message": "Login attempt initiated", "request_id": "d4f9bdf3-5933-4e63-b8f2-82ff830a17c5"}
{"timestamp": "2025-01-13T16:21:37.193541", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 689, "message": "Generating tokens", "user_id": "24"}
{"timestamp": "2025-01-13T16:21:37.245409", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 433, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-13T16:21:37.245977", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 433, "message": "Token created successfully", "user_id": "24"}
{"timestamp": "2025-01-13T16:21:37.246259", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 706, "message": "Token expiration times"}
{"timestamp": "2025-01-13T16:21:37.246926", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 746, "message": "User logged in successfully", "user_id": "24"}
{"timestamp": "2025-01-13T16:21:37.255476", "level": "INFO", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 235, "message": "Login successful", "request_id": "d4f9bdf3-5933-4e63-b8f2-82ff830a17c5", "user_id": "24"}
{"timestamp": "2025-01-13T16:22:51.223523", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:22:51.229264", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:22:51.266557", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:23:58.191002", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:23:58.193708", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:23:58.213515", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:24:46.590096", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:24:46.592484", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:24:46.611170", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:25:42.063135", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:25:42.067275", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:25:42.085107", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:26:26.527737", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:26:26.529254", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:26:26.545244", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:26:26.615955", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "class_service", "function": "create_class", "line": 133, "message": "Error creating class: TypeError", "exception": {"type": "TypeError", "message": "'created_at' is an invalid keyword argument for Class", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/class_service.py\", line 103, in create_class\n    new_class = Class(\n                ^^^^^^\n", "  File \"<string>\", line 4, in __init__\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py\", line 571, in _initialize_instance\n    with util.safe_reraise():\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py\", line 569, in _initialize_instance\n    manager.original_init(*mixed[1:], **kwargs)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py\", line 2167, in _declarative_constructor\n    raise TypeError(\n", "TypeError: 'created_at' is an invalid keyword argument for Class\n"]}}
{"timestamp": "2025-01-13T16:28:13.452321", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:28:13.460458", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:28:13.478904", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:28:13.615902", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)", "exception": {"type": "MissingGreenlet", "message": "greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/routes/admin.py\", line 348, in create_class\n    id=db_class.id,\n       ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 566, in __get__\n    return self.impl.get(state, dict_)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1086, in get\n    value = self._fire_loader_callables(state, key, passive)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1116, in _fire_loader_callables\n    return state._load_expired(state, passive)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py\", line 803, in _load_expired\n    self.manager.expired_attribute_loader(self, toload, passive)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 1670, in load_scalar_attributes\n    result = load_on_ident(\n             ^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 509, in load_on_ident\n    return load_on_pk_identity(\n           ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 694, in load_on_pk_identity\n    session.execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2247, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 305, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 2358, in _handle_dbapi_exception\n    raise exc_info[1].with_traceback(exc_info[2])\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 123, in await_only\n    raise exc.MissingGreenlet(\n", "sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)\n"]}}
{"timestamp": "2025-01-13T16:30:53.906622", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:30:53.914188", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:30:53.929388", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:31:04.533566", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:31:04.535256", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:31:04.555167", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:31:04.571433", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "class_service", "function": "create_class", "line": 128, "message": "Error creating class: InvalidRequestError", "exception": {"type": "InvalidRequestError", "message": "A transaction is already begun on this Session.", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/class_service.py\", line 101, in create_class\n    async with self.transaction() as session:\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 210, in __aenter__\n    return await anext(self.gen)\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/class_service.py\", line 181, in transaction\n    async with self.db.begin() as session:\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py\", line 121, in __aenter__\n    return await self.start(is_ctxmanager=True)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py\", line 1865, in start\n    await greenlet_spawn(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 1939, in begin\n    raise sa_exc.InvalidRequestError(\n", "sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.\n"]}}
{"timestamp": "2025-01-13T16:33:01.679195", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:33:01.684852", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:33:01.697983", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:33:01.788291", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: 'Class' object has no attribute 'created_at'", "exception": {"type": "AttributeError", "message": "'Class' object has no attribute 'created_at'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/routes/admin.py\", line 350, in create_class\n    created_at=db_class.created_at or datetime.utcnow(),\n               ^^^^^^^^^^^^^^^^^^^\n", "AttributeError: 'Class' object has no attribute 'created_at'\n"]}}
{"timestamp": "2025-01-13T16:34:48.343536", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:34:48.350275", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:34:48.364153", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:34:48.444927", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 108, "message": "Auth middleware error: 1 validation error for ClassResponse\ncreated_at\n  Field required [type=missing, input_value={'id': 16, 'name': 'Form 17'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.9/v/missing", "exception": {"type": "ValidationError", "message": "1 validation error for ClassResponse\ncreated_at\n  Field required [type=missing, input_value={'id': 16, 'name': 'Form 17'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.9/v/missing", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 111, in receive\n    return self.receive_nowait()\n           ^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 106, in receive_nowait\n    raise WouldBlock\n", "anyio.WouldBlock\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 124, in receive\n    return receiver.item\n           ^^^^^^^^^^^^^\n", "AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 157, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/auth.py\", line 78, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n", "  File \"/usr/lib/python3.12/contextlib.py\", line 158, in __exit__\n    self.gen.throw(value)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/middleware/request_id.py\", line 11, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/routes/admin.py\", line 347, in create_class\n    return ClassResponse(\n           ^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/pydantic/main.py\", line 212, in __init__\n    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "pydantic_core._pydantic_core.ValidationError: 1 validation error for ClassResponse\ncreated_at\n  Field required [type=missing, input_value={'id': 16, 'name': 'Form 17'}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.9/v/missing\n"]}}
{"timestamp": "2025-01-13T16:35:33.396912", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:35:33.401485", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:35:33.415346", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:37:18.394402", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:37:18.397773", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:37:18.414259", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:38:43.844635", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:38:43.846608", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 626, "message": "Failed to check token revocation status", "exception": {"type": "AttributeError", "message": "'_CachedRequest' object has no attribute 'begin'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 613, in check_token_revocation\n    async with self.db.begin() as transaction:\n               ^^^^^^^^^^^^^\n", "AttributeError: '_CachedRequest' object has no attribute 'begin'\n"]}}
{"timestamp": "2025-01-13T16:38:43.862608", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 964, "message": "Token validated successfully"}
{"timestamp": "2025-01-13T16:55:32.872363", "level": "DEBUG", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 944, "message": "Attempting to verify token"}
{"timestamp": "2025-01-13T16:55:32.902227", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 548, "message": "Unexpected error during token verification", "exception": {"type": "AttributeError", "message": "module 'jose.jwt' has no attribute 'InvalidIssuerError'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 481, in verify_token\n    payload = jwt.decode(\n              ^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 157, in decode\n    _validate_claims(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 481, in _validate_claims\n    _validate_exp(claims, leeway=leeway)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/jose/jwt.py\", line 314, in _validate_exp\n    raise ExpiredSignatureError(\"Signature has expired.\")\n", "jose.exceptions.ExpiredSignatureError: Signature has expired.\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 488, in verify_token\n    except jwt.InvalidIssuerError:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: module 'jose.jwt' has no attribute 'InvalidIssuerError'\n"]}}
{"timestamp": "2025-01-13T16:55:32.925421", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "validate_token", "line": 971, "message": "Unexpected error during token validation: 401: Could not validate credentials"}
{"timestamp": "2025-01-13T16:55:32.925863", "level": "WARNING", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "dispatch", "line": 95, "message": "Authentication failed: Token validation failed"}
