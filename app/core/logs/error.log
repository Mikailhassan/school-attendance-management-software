{"timestamp": "2024-12-30T12:17:20.238271", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "school_service", "function": "create_school", "line": 149, "message": "Failed to create school: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint \"schools_registration_number_key\"\nDETAIL:  Key (registration_number)=(SCH-2024-001) already exists.\n[SQL: INSERT INTO schools (name, email, phone, registration_number, school_type, website, status, address, county, postal_code, class_system, class_range, extra_info, is_active, created_at) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::JSON, $14::BOOLEAN, $15::TIMESTAMP WITH TIME ZONE) RETURNING schools.id, schools.updated_at]\n[parameters: ('Green Academy', 'abdiazizismail51@gmail.com', '+254723423256', 'SCH-2024-001', <SchoolType.PRIMARY: 'primary'>, None, <SchoolStatus.ACTIVE: 'active'>, '123 Learning Road, Nairobi', 'Nairobi', '00100', '8-4-4', '{\"lower_bound\": 1, \"upper_bound\": 8}', '{\"motto\": \"Excellence in Education\", \"founded\": 1995}', True, datetime.datetime(2024, 12, 30, 12, 17, 19, 300535))]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2024-12-30T12:28:47.675427", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "school_service", "function": "create_school", "line": 209, "message": "Failed to create school: 'SchoolService' object has no attribute '_store_password_reset_token'"}
{"timestamp": "2024-12-30T13:42:04.499560", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "school_service", "function": "create_school", "line": 203, "message": "Failed to create school: module 'app.services.email_service' has no attribute 'send_school_admin_credentials'"}
{"timestamp": "2024-12-30T18:15:05.936973", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 126, "message": "Authentication error: 401: Invalid credentials"}
{"timestamp": "2024-12-30T18:17:08.631483", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 126, "message": "Authentication error: 401: Invalid credentials"}
{"timestamp": "2024-12-30T18:17:46.703252", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 126, "message": "Authentication error: 'AuthService' object has no attribute 'create_access_token'"}
{"timestamp": "2024-12-30T18:20:40.339288", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 140, "message": "Authentication error: 'Settings' object has no attribute 'PRODUCTION'"}
{"timestamp": "2024-12-30T20:03:08.138093", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 166, "message": "Authentication error: 'str' object has no attribute 'headers'"}
{"timestamp": "2024-12-30T20:17:02.581214", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 166, "message": "Authentication error: 'str' object has no attribute 'headers'"}
{"timestamp": "2024-12-30T20:20:12.133086", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 166, "message": "Authentication error: 'str' object has no attribute 'headers'"}
{"timestamp": "2024-12-30T20:44:46.744809", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "get_current_user", "line": 247, "message": "Unexpected error in get_current_user: type object 'RevokedToken' has no attribute 'token'"}
{"timestamp": "2024-12-30T21:11:13.691609", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 92, "message": "Token verification error: Signature has expired."}
{"timestamp": "2024-12-30T21:11:13.724766", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "get_current_user", "line": 237, "message": "Unexpected error in get_current_user: 401: Invalid token"}
{"timestamp": "2024-12-30T21:11:59.062403", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 190, "message": "Authentication error: name 'set_auth_cookies' is not defined"}
{"timestamp": "2024-12-31T05:46:12.096245", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 239, "message": "Token revocation check error: type object 'RevokedToken' has no attribute 'expiration'"}
{"timestamp": "2024-12-31T05:54:41.482499", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 239, "message": "Token revocation check error: type object 'RevokedToken' has no attribute 'expiration'"}
{"timestamp": "2024-12-31T05:56:47.195508", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 239, "message": "Token revocation check error: type object 'RevokedToken' has no attribute 'expiration'"}
{"timestamp": "2024-12-31T05:57:09.346949", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 239, "message": "Token revocation check error: type object 'RevokedToken' has no attribute 'expiration'"}
{"timestamp": "2024-12-31T05:57:55.036223", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 239, "message": "Token revocation check error: type object 'RevokedToken' has no attribute 'expiration'"}
{"timestamp": "2024-12-31T05:57:55.932228", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "school_service", "function": "create_school", "line": 203, "message": "Failed to create school: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $6: Url('http://sakagirlssecondaryschool.com... (expected str, got Url)\n[SQL: INSERT INTO schools (name, email, phone, registration_number, school_type, website, status, address, county, postal_code, class_system, class_range, extra_info, is_active, created_at) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::JSON, $14::BOOLEAN, $15::TIMESTAMP WITH TIME ZONE) RETURNING schools.id, schools.updated_at]\n[parameters: ('Saka Girls Secondary School', 'sakagirlssecschol@gmail.com', '+254723456789', 'SCH-2024-007', <SchoolType.SECONDARY: 'secondary'>, Url('http://sakagirlssecondaryschool.com/'), <SchoolStatus.ACTIVE: 'active'>, '123 Saka Road, Northern County', 'Northern County', '00100', 'Standard 8-4-4', '{\"start\": 1, \"end\": 4}', '{\"motto\": \"Education for a brighter future\", \"established\": \"2005\"}', True, datetime.datetime(2024, 12, 31, 5, 57, 55, 313933))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}
{"timestamp": "2024-12-31T05:57:55.934198", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_school", "line": 75, "message": "Error creating school: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $6: Url('http://sakagirlssecondaryschool.com... (expected str, got Url)\n[SQL: INSERT INTO schools (name, email, phone, registration_number, school_type, website, status, address, county, postal_code, class_system, class_range, extra_info, is_active, created_at) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::JSON, $14::BOOLEAN, $15::TIMESTAMP WITH TIME ZONE) RETURNING schools.id, schools.updated_at]\n[parameters: ('Saka Girls Secondary School', 'sakagirlssecschol@gmail.com', '+254723456789', 'SCH-2024-007', <SchoolType.SECONDARY: 'secondary'>, Url('http://sakagirlssecondaryschool.com/'), <SchoolStatus.ACTIVE: 'active'>, '123 Saka Road, Northern County', 'Northern County', '00100', 'Standard 8-4-4', '{\"start\": 1, \"end\": 4}', '{\"motto\": \"Education for a brighter future\", \"established\": \"2005\"}', True, datetime.datetime(2024, 12, 31, 5, 57, 55, 313933))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}
{"timestamp": "2024-12-31T06:08:38.267237", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 239, "message": "Token revocation check error: type object 'RevokedToken' has no attribute 'expiration'"}
{"timestamp": "2024-12-31T06:08:38.836881", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "school_service", "function": "create_school", "line": 203, "message": "Failed to create school: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $6: Url('http://sakagirlssecondaryschool.com... (expected str, got Url)\n[SQL: INSERT INTO schools (name, email, phone, registration_number, school_type, website, status, address, county, postal_code, class_system, class_range, extra_info, is_active, created_at) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::JSON, $14::BOOLEAN, $15::TIMESTAMP WITH TIME ZONE) RETURNING schools.id, schools.updated_at]\n[parameters: ('Saka Girls Secondary School', 'sakagirlssecschol@gmail.com', '+254723456789', 'SCH-2024-007', <SchoolType.SECONDARY: 'secondary'>, Url('http://sakagirlssecondaryschool.com/'), <SchoolStatus.ACTIVE: 'active'>, '123 Saka Road, Northern County', 'Northern County', '00100', 'Standard 8-4-4', '{\"start\": 1, \"end\": 4}', '{\"motto\": \"Education for a brighter future\", \"established\": \"2005\"}', True, datetime.datetime(2024, 12, 31, 6, 8, 38, 526915))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}
{"timestamp": "2024-12-31T06:08:38.837653", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_school", "line": 75, "message": "Error creating school: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $6: Url('http://sakagirlssecondaryschool.com... (expected str, got Url)\n[SQL: INSERT INTO schools (name, email, phone, registration_number, school_type, website, status, address, county, postal_code, class_system, class_range, extra_info, is_active, created_at) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::JSON, $13::JSON, $14::BOOLEAN, $15::TIMESTAMP WITH TIME ZONE) RETURNING schools.id, schools.updated_at]\n[parameters: ('Saka Girls Secondary School', 'sakagirlssecschol@gmail.com', '+254723456789', 'SCH-2024-007', <SchoolType.SECONDARY: 'secondary'>, Url('http://sakagirlssecondaryschool.com/'), <SchoolStatus.ACTIVE: 'active'>, '123 Saka Road, Northern County', 'Northern County', '00100', 'Standard 8-4-4', '{\"start\": 1, \"end\": 4}', '{\"motto\": \"Education for a brighter future\", \"established\": \"2005\"}', True, datetime.datetime(2024, 12, 31, 6, 8, 38, 526915))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)"}
{"timestamp": "2024-12-31T06:11:41.257515", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_token_revocation", "line": 239, "message": "Token revocation check error: type object 'RevokedToken' has no attribute 'expiration'"}
{"timestamp": "2024-12-31T13:36:50.575288", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 555, "message": "Authentication error: 'RateLimiter' object has no attribute 'check_rate_limit'"}
{"timestamp": "2024-12-31T13:38:23.099066", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 555, "message": "Authentication error: 'RateLimiter' object has no attribute 'check_rate_limit'"}
{"timestamp": "2024-12-31T13:39:14.015592", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 555, "message": "Authentication error: 'RateLimiter' object has no attribute 'check_rate_limit'"}
{"timestamp": "2024-12-31T13:39:14.017744", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T13:42:04.126864", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 555, "message": "Authentication error: 'RateLimiter' object has no attribute 'check_rate_limit'"}
{"timestamp": "2024-12-31T13:42:04.129460", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T13:46:32.184950", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 555, "message": "Authentication error: RateLimiter.check_rate_limit() got an unexpected keyword argument 'max_requests'"}
{"timestamp": "2024-12-31T13:46:32.187742", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T13:51:11.086905", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "check_account_lockout", "line": 136, "message": "Error checking account lockout: type object 'FailedLoginAttempt' has no attribute 'email'"}
{"timestamp": "2024-12-31T13:51:12.077284", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "clear_failed_attempts", "line": 161, "message": "Error clearing failed attempts: type object 'FailedLoginAttempt' has no attribute 'email'"}
{"timestamp": "2024-12-31T13:51:12.152523", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 555, "message": "Authentication error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2024-12-31T13:51:12.167702", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T14:27:15.399394", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 555, "message": "Authentication error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2024-12-31T14:27:15.403124", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T16:28:10.569982", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 555, "message": "Authentication error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2024-12-31T16:28:10.602985", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T17:22:35.997003", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "transaction", "line": 45, "message": "Transaction error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2024-12-31T17:22:36.019577", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 432, "message": "Database error during authentication: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2024-12-31T17:22:36.023164", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T17:25:39.050474", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 438, "message": "Authentication error: 'coroutine' object has no attribute 'check_rate_limit'"}
{"timestamp": "2024-12-31T17:25:39.055622", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T17:41:03.925475", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 441, "message": "Authentication error: 'AuthService' object has no attribute 'rate_limiter'"}
{"timestamp": "2024-12-31T17:41:03.936561", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T17:44:09.041010", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 443, "message": "Authentication error: 'AuthService' object has no attribute 'rate_limiter'"}
{"timestamp": "2024-12-31T17:44:09.043687", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T18:37:00.922865", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 406, "message": "Authentication error: 'NoneType' object has no attribute 'check_rate_limit'"}
{"timestamp": "2024-12-31T18:37:00.928397", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 198, "message": "Unexpected error during login: 500: Authentication failed"}
{"timestamp": "2024-12-31T18:45:47.164507", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 230, "message": "Unexpected error during login: name 'EmailStr' is not defined", "exception": {"type": "NameError", "message": "name 'EmailStr' is not defined", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 166, in login\n    if not isinstance(credentials.email, EmailStr):\n                                         ^^^^^^^^\n", "NameError: name 'EmailStr' is not defined\n"]}}
{"timestamp": "2024-12-31T18:48:27.589796", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 444, "message": "Authentication error: 'AuthService' object has no attribute 'rate_limiter'"}
{"timestamp": "2024-12-31T18:48:27.592340", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: 500: Authentication failed", "exception": {"type": "HTTPException", "message": "500: Authentication failed", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 368, in authenticate_user\n    if not await self.rate_limiter.check_rate_limit(request, \"login\", max_requests=5):\n                 ^^^^^^^^^^^^^^^^^\n", "AttributeError: 'AuthService' object has no attribute 'rate_limiter'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 445, in authenticate_user\n    raise HTTPException(\n", "fastapi.exceptions.HTTPException: 500: Authentication failed\n"]}}
{"timestamp": "2024-12-31T18:54:34.271772", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: name 'ValidationError' is not defined", "exception": {"type": "NameError", "message": "name 'ValidationError' is not defined", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 372, in authenticate_user\n    if not is_valid_email(email):\n           ^^^^^^^^^^^^^^\n", "NameError: name 'is_valid_email' is not defined\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 482, in authenticate_user\n    except ValidationError as e:\n           ^^^^^^^^^^^^^^^\n", "NameError: name 'ValidationError' is not defined\n"]}}
{"timestamp": "2024-12-31T19:05:49.083290", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 444, "message": "Authentication error: 'AuthService' object has no attribute 'rate_limiter'"}
{"timestamp": "2024-12-31T19:05:49.091331", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: 500: Authentication failed", "exception": {"type": "HTTPException", "message": "500: Authentication failed", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 368, in authenticate_user\n    if not await self.rate_limiter.check_rate_limit(request, \"login\", max_requests=5):\n                 ^^^^^^^^^^^^^^^^^\n", "AttributeError: 'AuthService' object has no attribute 'rate_limiter'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 445, in authenticate_user\n    raise HTTPException(\n", "fastapi.exceptions.HTTPException: 500: Authentication failed\n"]}}
{"timestamp": "2024-12-31T19:22:53.960130", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: name 'AccountLockedException' is not defined", "exception": {"type": "NameError", "message": "name 'AccountLockedException' is not defined", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 388, in authenticate_user\n    if not await self.rate_limiter.check_rate_limit(request, \"login\", max_requests=5):\n                 ^^^^^^^^^^^^^^^^^\n", "AttributeError: 'AuthService' object has no attribute 'rate_limiter'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 455, in authenticate_user\n    except AccountLockedException:\n           ^^^^^^^^^^^^^^^^^^^^^^\n", "NameError: name 'AccountLockedException' is not defined\n"]}}
{"timestamp": "2024-12-31T19:23:32.638857", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 468, "message": "Authentication error: 'AuthService' object has no attribute 'rate_limiter'"}
{"timestamp": "2024-12-31T19:23:32.639836", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: 500: Authentication failed", "exception": {"type": "HTTPException", "message": "500: Authentication failed", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 388, in authenticate_user\n    if not await self.rate_limiter.check_rate_limit(request, \"login\", max_requests=5):\n                 ^^^^^^^^^^^^^^^^^\n", "AttributeError: 'AuthService' object has no attribute 'rate_limiter'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 469, in authenticate_user\n    raise HTTPException(\n", "fastapi.exceptions.HTTPException: 500: Authentication failed\n"]}}
{"timestamp": "2024-12-31T19:27:47.687474", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 468, "message": "Authentication error: 'AuthService' object has no attribute 'rate_limiter'"}
{"timestamp": "2024-12-31T19:27:47.704021", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: 500: Authentication failed", "exception": {"type": "HTTPException", "message": "500: Authentication failed", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 388, in authenticate_user\n    if not await self.rate_limiter.check_rate_limit(request, \"login\", max_requests=5):\n                 ^^^^^^^^^^^^^^^^^\n", "AttributeError: 'AuthService' object has no attribute 'rate_limiter'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 469, in authenticate_user\n    raise HTTPException(\n", "fastapi.exceptions.HTTPException: 500: Authentication failed\n"]}}
{"timestamp": "2024-12-31T19:33:27.877470", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "initialize", "line": 75, "message": "Failed to initialize AuthService: Missing required JWT settings: SECRET_KEY, ALGORITHM, ACCESS_TOKEN_EXPIRE_MINUTES, REFRESH_TOKEN_EXPIRE_DAYS, FAILED_ATTEMPTS, DURATION_MINUTES, RATE_LIMIT_MAX_REQUESTS, RATE_LIMIT_TIME_WINDOW"}
{"timestamp": "2024-12-31T19:33:27.885216", "level": "CRITICAL", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 217, "message": "Configuration error during login: Failed to initialize authentication service"}
{"timestamp": "2024-12-31T19:45:08.225154", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "transaction", "line": 57, "message": "Transaction error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2024-12-31T19:45:08.232304", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 396, "message": "Database error during authentication: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2024-12-31T19:45:08.233100", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: 500: Authentication failed", "exception": {"type": "HTTPException", "message": "500: Authentication failed", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 363, in authenticate_user\n    sub=str(user.id),\n            ^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 566, in __get__\n    return self.impl.get(state, dict_)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1086, in get\n    value = self._fire_loader_callables(state, key, passive)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1116, in _fire_loader_callables\n    return state._load_expired(state, passive)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py\", line 803, in _load_expired\n    self.manager.expired_attribute_loader(self, toload, passive)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 1670, in load_scalar_attributes\n    result = load_on_ident(\n             ^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 509, in load_on_ident\n    return load_on_pk_identity(\n           ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 694, in load_on_pk_identity\n    session.execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2247, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 305, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 2358, in _handle_dbapi_exception\n    raise exc_info[1].with_traceback(exc_info[2])\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 123, in await_only\n    raise exc.MissingGreenlet(\n", "sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 397, in authenticate_user\n    raise HTTPException(\n", "fastapi.exceptions.HTTPException: 500: Authentication failed\n"]}}
{"timestamp": "2025-01-01T04:57:43.054973", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 410, "message": "Unexpected authentication error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2025-01-01T04:57:43.069345", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: name 'SQLAlchemyError' is not defined", "exception": {"type": "NameError", "message": "name 'SQLAlchemyError' is not defined", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 379, in authenticate_user\n    sub=str(user.id),\n            ^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 566, in __get__\n    return self.impl.get(state, dict_)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1086, in get\n    value = self._fire_loader_callables(state, key, passive)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1116, in _fire_loader_callables\n    return state._load_expired(state, passive)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py\", line 803, in _load_expired\n    self.manager.expired_attribute_loader(self, toload, passive)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 1670, in load_scalar_attributes\n    result = load_on_ident(\n             ^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 509, in load_on_ident\n    return load_on_pk_identity(\n           ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 694, in load_on_pk_identity\n    session.execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2247, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 305, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 2358, in _handle_dbapi_exception\n    raise exc_info[1].with_traceback(exc_info[2])\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 123, in await_only\n    raise exc.MissingGreenlet(\n", "sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 413, in authenticate_user\n    detail=get_error_message(\"authentication_failed\", language)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/core/errors.py\", line 192, in get_error_message\n    elif isinstance(error, SQLAlchemyError):\n                           ^^^^^^^^^^^^^^^\n", "NameError: name 'SQLAlchemyError' is not defined\n"]}}
{"timestamp": "2025-01-01T05:00:18.928693", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 410, "message": "Unexpected authentication error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)"}
{"timestamp": "2025-01-01T05:00:18.933124", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth", "function": "login", "line": 224, "message": "Unexpected error during login: 500: {'success': False, 'error_code': 'GENERAL_ERROR', 'message': 'authentication_failed', 'status_code': 500}", "exception": {"type": "HTTPException", "message": "500: {'success': False, 'error_code': 'GENERAL_ERROR', 'message': 'authentication_failed', 'status_code': 500}", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 379, in authenticate_user\n    sub=str(user.id),\n            ^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 566, in __get__\n    return self.impl.get(state, dict_)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1086, in get\n    value = self._fire_loader_callables(state, key, passive)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1116, in _fire_loader_callables\n    return state._load_expired(state, passive)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py\", line 803, in _load_expired\n    self.manager.expired_attribute_loader(self, toload, passive)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 1670, in load_scalar_attributes\n    result = load_on_ident(\n             ^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 509, in load_on_ident\n    return load_on_pk_identity(\n           ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 694, in load_on_pk_identity\n    session.execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2247, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 305, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 2358, in _handle_dbapi_exception\n    raise exc_info[1].with_traceback(exc_info[2])\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 572, in execute\n    self._adapt_connection.await_(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 123, in await_only\n    raise exc.MissingGreenlet(\n", "sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/routes/auth.py\", line 173, in login\n    auth_result = await auth_service.authenticate_user(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 411, in authenticate_user\n    raise HTTPException(\n", "fastapi.exceptions.HTTPException: 500: {'success': False, 'error_code': 'GENERAL_ERROR', 'message': 'authentication_failed', 'status_code': 500}\n"]}}
{"timestamp": "2025-01-01T06:09:14.050663", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 302, "message": "Token creation value error: Token must include user identifier (sub)"}
{"timestamp": "2025-01-01T06:48:34.291308", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 305, "message": "Error creating access token: Logger._log() got an unexpected keyword argument 'type'"}
{"timestamp": "2025-01-01T06:54:41.483226", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "verify_token", "line": 366, "message": "Unexpected token verification error: Logger._log() got an unexpected keyword argument 'type'"}
{"timestamp": "2025-01-01T06:58:00.799940", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_school", "line": 75, "message": "Error creating school: 'ClassRange' object has no attribute 'get'"}
{"timestamp": "2025-01-01T06:58:42.652761", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_school", "line": 75, "message": "Error creating school: 'ClassRange' object has no attribute 'get'"}
{"timestamp": "2025-01-01T07:03:09.795740", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_school", "line": 75, "message": "Error creating school: 'ClassRange' object has no attribute 'get'"}
{"timestamp": "2025-01-01T07:05:28.038480", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_school", "line": 75, "message": "Error creating school: 'ClassRange' object has no attribute 'get'"}
{"timestamp": "2025-01-01T07:09:12.444538", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "school_service", "function": "create_school", "line": 218, "message": "Error creating school: 'ClassRange' object has no attribute 'get'"}
{"timestamp": "2025-01-01T07:09:12.448254", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_school", "line": 75, "message": "Error creating school: name 'HTTPException' is not defined"}
{"timestamp": "2025-01-01T08:06:45.320956", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "school_service", "function": "create_school", "line": 219, "message": "Error creating school: 'ClassRange' object has no attribute 'get'"}
{"timestamp": "2025-01-01T08:06:45.323252", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "admin", "function": "create_school", "line": 75, "message": "Error creating school: name 'status' is not defined"}
{"timestamp": "2025-01-01T08:24:59.963357", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 238, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (1, null, 2025-01-01 00:24:59.892518-08, 127.0.0.1, null, hafswirakullow@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('hafswirakullow@gmail.com', datetime.datetime(2025, 1, 1, 8, 24, 59, 892518, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:27:05.485025", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 238, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (2, null, 2025-01-01 00:27:05.445989-08, 127.0.0.1, null, hafswirakullow@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('hafswirakullow@gmail.com', datetime.datetime(2025, 1, 1, 8, 27, 5, 445989, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:35:41.847420", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (3, null, 2025-01-01 00:35:41.797731-08, 127.0.0.1, null, hafswirakullow@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('hafswirakullow@gmail.com', datetime.datetime(2025, 1, 1, 8, 35, 41, 797731, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:34.744681", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (4, null, 2025-01-01 00:38:34.64874-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 34, 648740, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:40.176481", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (5, null, 2025-01-01 00:38:40.172827-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 40, 172827, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:42.446874", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (6, null, 2025-01-01 00:38:42.433446-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 42, 433446, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:44.348765", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (7, null, 2025-01-01 00:38:44.346156-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 44, 346156, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:46.286052", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (8, null, 2025-01-01 00:38:46.27594-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 46, 275940, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:48.394729", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (9, null, 2025-01-01 00:38:48.390929-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 48, 390929, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:50.797439", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (10, null, 2025-01-01 00:38:50.791173-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 50, 791173, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:53.239327", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (11, null, 2025-01-01 00:38:53.231582-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 53, 231582, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T08:38:55.386302", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 286, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (12, null, 2025-01-01 00:38:55.383954-08, 127.0.0.1, null, mikailismail260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismail260@gmail.com', datetime.datetime(2025, 1, 1, 8, 38, 55, 383954, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-01T17:15:41.640893", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-01T17:17:52.437969", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-01T17:18:51.180900", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-01T17:21:07.323828", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-01T17:29:09.852233", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-01T17:32:01.857907", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 605, "message": "Unexpected authentication error: 'AuthService' object has no attribute 'create_token'"}
{"timestamp": "2025-01-01T17:33:56.023734", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 376, "message": "Error creating access token: 'JWTSettings' object has no attribute 'TOKEN_ISSUER'", "exception": {"type": "AttributeError", "message": "'JWTSettings' object has no attribute 'TOKEN_ISSUER'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 352, in create_token\n    \"iss\": self.settings.TOKEN_ISSUER  # Add issuer claim\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/pydantic/main.py\", line 856, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'JWTSettings' object has no attribute 'TOKEN_ISSUER'\n"]}}
{"timestamp": "2025-01-01T17:34:27.770407", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "create_token", "line": 376, "message": "Error creating access token: 'JWTSettings' object has no attribute 'TOKEN_ISSUER'", "exception": {"type": "AttributeError", "message": "'JWTSettings' object has no attribute 'TOKEN_ISSUER'", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 352, in create_token\n    \"iss\": self.settings.TOKEN_ISSUER  # Add issuer claim\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/pydantic/main.py\", line 856, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'JWTSettings' object has no attribute 'TOKEN_ISSUER'\n"]}}
{"timestamp": "2025-01-01T17:50:31.532310", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-01T18:16:21.835570", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-01T18:16:58.987864", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-01T18:34:31.200186", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "log_auth_event", "line": 87, "message": "Auth event"}
{"timestamp": "2025-01-02T04:48:53.464372", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 531, "message": "Unexpected authentication error: Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands."}
{"timestamp": "2025-01-02T04:52:36.811723", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 531, "message": "Unexpected authentication error: Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands."}
{"timestamp": "2025-01-02T05:01:16.103800", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 542, "message": "Unexpected authentication error"}
{"timestamp": "2025-01-02T05:03:49.395982", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 542, "message": "Unexpected authentication error"}
{"timestamp": "2025-01-02T05:11:10.563846", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 287, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (13, null, 2025-01-01 21:11:10.434245-08, 127.0.0.1, null, mikailismai260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismai260@gmail.com', datetime.datetime(2025, 1, 2, 5, 11, 10, 434245, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-02T05:13:48.410183", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 287, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (14, null, 2025-01-01 21:13:48.383433-08, 127.0.0.1, null, mikailismai260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismai260@gmail.com', datetime.datetime(2025, 1, 2, 5, 13, 48, 383433, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-02T05:14:31.272382", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "record_failed_attempt", "line": 287, "message": "Error recording failed attempt: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"school_id\" of relation \"failed_login_attempts\" violates not-null constraint\nDETAIL:  Failing row contains (15, null, 2025-01-01 21:14:31.258822-08, 127.0.0.1, null, mikailismai260@gmail.com).\n[SQL: INSERT INTO failed_login_attempts (email, timestamp, ip_address, user_id, school_id) VALUES ($1::VARCHAR, $2::TIMESTAMP WITH TIME ZONE, $3::VARCHAR, $4::INTEGER, $5::INTEGER) RETURNING failed_login_attempts.id]\n[parameters: ('mikailismai260@gmail.com', datetime.datetime(2025, 1, 2, 5, 14, 31, 258822, tzinfo=datetime.timezone.utc), '127.0.0.1', None, None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"timestamp": "2025-01-02T05:14:46.802385", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 542, "message": "Unexpected authentication error"}
{"timestamp": "2025-01-02T05:25:18.471944", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 543, "message": "Unexpected authentication error"}
{"timestamp": "2025-01-02T05:30:18.901715", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 543, "message": "Unexpected authentication error", "exception": {"type": "InvalidRequestError", "message": "Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands.", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 498, in authenticate_user\n    sub=str(user.id),\n            ^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 566, in __get__\n    return self.impl.get(state, dict_)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1086, in get\n    value = self._fire_loader_callables(state, key, passive)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1116, in _fire_loader_callables\n    return state._load_expired(state, passive)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py\", line 803, in _load_expired\n    self.manager.expired_attribute_loader(self, toload, passive)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 1670, in load_scalar_attributes\n    result = load_on_ident(\n             ^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 509, in load_on_ident\n    return load_on_pk_identity(\n           ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 694, in load_on_pk_identity\n    session.execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2237, in _execute_internal\n    conn = self._connection_for_bind(bind)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2101, in _connection_for_bind\n    TransactionalContext._trans_ctx_check(self)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/util.py\", line 111, in _trans_ctx_check\n    raise exc.InvalidRequestError(\n", "sqlalchemy.exc.InvalidRequestError: Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands.\n"]}}
{"timestamp": "2025-01-02T05:32:39.762826", "level": "ERROR", "logger": "SchoolAttendanceLogger", "module": "auth_service", "function": "authenticate_user", "line": 552, "message": "Unexpected authentication error", "exception": {"type": "InvalidRequestError", "message": "Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands.", "traceback": ["Traceback (most recent call last):\n", "  File \"/root/projects/school-attendance-management-software/app/services/auth_service.py\", line 508, in authenticate_user\n    user_id=user.id  # This should be safe as it's already loaded\n            ^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 566, in __get__\n    return self.impl.get(state, dict_)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1086, in get\n    value = self._fire_loader_callables(state, key, passive)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py\", line 1116, in _fire_loader_callables\n    return state._load_expired(state, passive)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py\", line 803, in _load_expired\n    self.manager.expired_attribute_loader(self, toload, passive)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 1670, in load_scalar_attributes\n    result = load_on_ident(\n             ^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 509, in load_on_ident\n    return load_on_pk_identity(\n           ^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py\", line 694, in load_on_pk_identity\n    session.execute(\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2237, in _execute_internal\n    conn = self._connection_for_bind(bind)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2101, in _connection_for_bind\n    TransactionalContext._trans_ctx_check(self)\n", "  File \"/root/projects/school-attendance-management-software/venv/lib/python3.12/site-packages/sqlalchemy/engine/util.py\", line 111, in _trans_ctx_check\n    raise exc.InvalidRequestError(\n", "sqlalchemy.exc.InvalidRequestError: Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands.\n"]}}
